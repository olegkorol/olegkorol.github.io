<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="Dc2DZ1iyJqu-n3ItWJrCx64Tq9vpcjI8JlozbUhuyoI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Oleg Korol&#39;s personal blog. Thoughts on Web Development and Tech in general. JavaScript Full-Stack.">
    <meta name="keyword"  content="oleg korol, javascript, web, development, frontend, backend, full-stack">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
          Creating a smart ChatBot for Slack - Oleg Korol&#39;s Blog
        
    </title>

    <link rel="canonical" href="https://olegkorol.github.io/2017/04/23/Creating-a-smart-ChatBot-for-Slack/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <!-- Custom Fonts -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Hotjar Tracking Code -->
    <script>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:455798,hjsv:5};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Just another random Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archives/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Image to hack wechat -->
<!-- <img src="https://olegkorol.github.io/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="{{ site.baseurl }}/{% if page.header-img %}{{ page.header-img }}{% else %}{{ site.header-img }}{% endif %}" width="0" height="0"> -->

<script type='text/javascript' src='http://platform-api.sharethis.com/js/sharethis.js#property=58962fc4b750240012d3ebf2&product=sticky-share-buttons' async='async'></script>

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/home-bg.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                          <a class="tag" href="/tags/#JavaScript" title="JavaScript">JavaScript</a>
                        
                          <a class="tag" href="/tags/#ChatBots" title="ChatBots">ChatBots</a>
                        
                          <a class="tag" href="/tags/#AI" title="AI">AI</a>
                        
                          <a class="tag" href="/tags/#Slack" title="Slack">Slack</a>
                        
                    </div>
                    <h1>Creating a smart ChatBot for Slack</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        Posted by Oleg Korol on
                        2017-04-23
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>Today I am going to write a quick guide on how to create a “smart” yet very simple ChatBot for Slack. We will be using Botkit to take care of the logistics (Slack integration) and IBM Watson’s “Conversation” so that our bot can actually “understand” our messages and respond to them accordingly. At first sight this might seem somewhat complex, but it isn’t. Believe me ;)</p>
<p>In order to accomplish that, we will:</p>
<ul>
<li>Create a Slack app</li>
<li>Setup the Botkit SDK</li>
<li>Register into Bluemix to use IBM Watson’s Conversation</li>
<li>Use Conversation together with Botkit</li>
<li>Have fun</li>
</ul>
<h2 id="Create-a-Slack-App"><a href="#Create-a-Slack-App" class="headerlink" title="Create a Slack App"></a>Create a Slack App</h2><p>First of all we are going to create a Slack App in order to get a token that lets us start using Slack’s API. Note that you could also <a href="https://api.slack.com/bot-users" target="_blank" rel="external">just create a bot</a>, but it takes about the same time and offers many less features to play with.<br>Before anything you will need to <a href="https://slack.com/create#email" target="_blank" rel="external">create a development team</a>, if you don’t have one yet. It is a requirement before being able to create any app. You will also be testing your ChatBot in this team later on.</p>
<p>Once you are ready to create the actual app, just go <a href="https://api.slack.com/apps?new_app=1" target="_blank" rel="external">here</a> and you should have all set up and be ready to start in a couple of clicks.<br>After that, you will need to 1) set a bot for your app and 2) install it to your development team.<br><img src="slack_app_01.png" alt="Slack App 01"></p>
<p>Then we will get a token that allows us to play with the bot in our team. Save it for the next step.<br><img src="slack_app_02.png" alt="Slack App 02"></p>
<h2 id="Botkit-setup"><a href="#Botkit-setup" class="headerlink" title="Botkit setup"></a>Botkit setup</h2><p>We will now start building the skeleton of the ChatBot with the help of <a href="https://www.npmjs.com/package/botkit" target="_blank" rel="external">Botkit</a>, which is a very helpful tool that provides us with the essential building blocks for chat apps. Botkit currently supports the following messaging platforms:</p>
<ul>
<li>Slack</li>
<li>Cisco Spark</li>
<li>Facebook Messenger</li>
<li>Twilio IP Messaging</li>
<li>Microsoft Bot Framework</li>
</ul>
<p>But we will only focus on Slack for now. The process is quite similar for all the other platforms.</p>
<p>First, a little bit of theory. Your bot (and any other API consumer) has three ways to communicate with your Slack team:</p>
<ul>
<li><a href="https://api.slack.com/rtm" target="_blank" rel="external">RTM (real time messaging)</a> <br><blockquote>
<p>The Real Time Messaging API is a WebSocket-based API that allows you to receive events from Slack in real time and send messages as users. It’s sometimes referred to as simply the “RTM API”.</p>
</blockquote>
</li>
<li><a href="https://api.slack.com/incoming-webhooks" target="_blank" rel="external">Incoming webhooks</a> <br><blockquote>
<p>Incoming Webhooks are a simple way to post messages from external sources into Slack. They make use of normal HTTP requests with a JSON payload that includes the message text and some options. Message Attachments can also be used in Incoming Webhooks to display richly-formatted messages that stand out from regular chat messages.</p>
</blockquote>
</li>
<li><a href="https://api.slack.com/slash-commands" target="_blank" rel="external">Slash commands</a> <br><blockquote>
<p>Slash Commands enable Slack users to interact with your app directly from Slack. (e.g. <code>/start</code> would be a slash command)</p>
</blockquote>
</li>
</ul>
<p>This example will focus on getting an input from Slack, processing it and then sending a response back. For this purpose, in my oppinion, the best choice is to use an RTM connection since it is more elegant and feels more natural than using slash commands. We will recognize what the user’s intent is by using artificial intelligence anyway rather than creating boring slash commands :)</p>
<p>Our goal here is to give the end-user the possibility to communicate with the bot as if it was a conversation with another human being and not only typing in CLI-like commands. Don’t get me wrong here, I actually love using the command line :)</p>
<p>Enough said. Let’s get our hands a little bit dirty by writing some code. We will create a tiny server on top of which the app will be running. I will be using Express, but you can use any framework that suits you best.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* server.js */</span></div><div class="line"><span class="meta"></span></div><div class="line">'use strict';</div><div class="line"></div><div class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">const</span> app = express();</div><div class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">4205</span>;</div><div class="line"><span class="keyword">const</span> router = express.Router();</div><div class="line"></div><div class="line"><span class="comment">// start server</span></div><div class="line">app.listen(port, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.info(<span class="string">`Started Express server on port <span class="subst">$&#123;port&#125;</span>`</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>In order to start working with Botkit, just install it using NPM: <code>npm install botkit --save</code>. And then let’s write something very simple that allows us to directly connect the Botkit instance with our Slack team:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* chatbots.js */</span></div><div class="line"><span class="meta"></span></div><div class="line">'use strict';</div><div class="line"><span class="keyword">const</span> Botkit       = <span class="built_in">require</span>(<span class="string">'botkit'</span>);</div><div class="line"></div><div class="line"><span class="comment">// use the tokens you got from the previous step</span></div><div class="line"><span class="keyword">const</span> slack_token  = process.env.SLACK_TOKEN;</div><div class="line"><span class="keyword">const</span> slack_oauth  = process.env.SLACK_OAUTH;</div><div class="line"></div><div class="line">exports.fn = &#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Starts Slack-Bot</div><div class="line">	 *</div><div class="line">	 * @returns &#123;*&#125;</div><div class="line">	 */</div><div class="line">	slackBot() &#123;</div><div class="line"></div><div class="line">		<span class="comment">// initialisation</span></div><div class="line">		<span class="keyword">const</span> slackController = Botkit.slackbot(&#123;</div><div class="line">			<span class="comment">// optional: wait for a confirmation events for each outgoing message before continuing to the next message in a conversation</span></div><div class="line">			require_delivery: <span class="literal">true</span></div><div class="line">		&#125;);</div><div class="line">		<span class="keyword">const</span> slackBot = slackController.spawn(&#123;</div><div class="line">			<span class="attr">token</span>: slack_token</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// create rtm connection</span></div><div class="line">		slackBot.startRTM(<span class="function">(<span class="params">err, bot, payload</span>) =&gt;</span> &#123;</div><div class="line">			<span class="keyword">if</span> (err) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Could not connect to Slack'</span>);</div><div class="line">			&#125;</div><div class="line">			slackController.log(<span class="string">'Slack connection established.'</span>);</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// listener that handles incoming messages</span></div><div class="line">		slackController.hears([<span class="string">'.*'</span>], [<span class="string">'direct_message'</span>, <span class="string">'direct_mention'</span>], (bot, message) =&gt; &#123;</div><div class="line">			slackController.log(<span class="string">'Slack message received'</span>);</div><div class="line">			bot.reply(<span class="string">'I have received your message!'</span>)</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>With this example whenever someone mentions the bot on a channel where the bot is present or whenever it receives a direct message, it will answer back “I have received your message”.</p>
<p>We could at this point create some logic that looks for specific keywords in the object <code>message</code> above, perform some actions according to its content and deliver a custom response. But this would be too boring. We want the bot to actually somehow understand what the incoming message means rather than only searching for some keywords. The process would be to slow and inefficient. This is where we will need the help of the great IBM Watson.</p>
<h2 id="IBM-Watson-Bluemix"><a href="#IBM-Watson-Bluemix" class="headerlink" title="IBM Watson / Bluemix"></a>IBM Watson / Bluemix</h2><p>IBM Watson offers some really cool AI and Machine Learning related services that are at the reach of everyone through IBM’s cloud development platform, <a href="https://www.ibm.com/cloud-computing/bluemix/" target="_blank" rel="external">Bluemix</a>, which not only includes Watson, but has to offer many other services (quite similar to AWS). There is a nice SDK to use Watson on Node.js hosted on GitHub, which includes detailed documentation on how to use each of its “modules”. Yo can have a look at it <a href="https://github.com/watson-developer-cloud/node-sdk" target="_blank" rel="external">here</a>. We will only focus on the module called “Conversation”. For more information see <a href="https://github.com/watson-developer-cloud/node-sdk#conversation" target="_blank" rel="external">here</a> and <a href="https://www.ibm.com/watson/developercloud/doc/conversation/index.html" target="_blank" rel="external">here</a>.</p>
<p>In order to start working with IBM Watson and Conversation, you will have to create an account at Bluemix (<a href="https://www.ibm.com/cloud-computing/bluemix/getting-started" target="_blank" rel="external">more infos here</a>).<br>I will not get too much into detail on how to create a Conversation service and set it up in Bluemix. The <a href="https://www.ibm.com/watson/developercloud/doc/conversation/getting-started.html" target="_blank" rel="external">official documentation</a> does quite a good job on explaining that.</p>
<p>That’s basically how Conversation works:<br><img src="conversation_01.png" alt="conversation_01"></p>
<p>First of all you will need to set a <a href="https://www.ibm.com/watson/developercloud/doc/conversation/getting-started.html#create-a-workspace" target="_blank" rel="external">workspace</a> (an instance of Conversation). Once you all set up you need to understand three main concepts of Conversation’s way of working:</p>
<ul>
<li><a href="https://www.ibm.com/watson/developercloud/doc/conversation/intents.html" target="_blank" rel="external">Intents</a>: these define the purpose of the user’s input aka. “what does the user want?”. This is the first thing that Conversation looks for when it receives a message, like “Okay, I received this message. What is the user’s goal?”. Once the user’s intent is clear, Conversation decides which is the correct dialog flow for the user (we will see what a Dialog is right now).</li>
<li><a href="https://www.ibm.com/watson/developercloud/doc/conversation/entities.html" target="_blank" rel="external">Entities</a>: these are “keywords” that further define the user’s intent. For example, if the user sends “Where can I buy beer?”, the intent is identified by the question “Where can I buy…” and “beer” would be the entity.</li>
<li><a href="https://www.ibm.com/watson/developercloud/doc/conversation/dialog-build.html" target="_blank" rel="external">Dialog</a>: the dialog is the whole conversation path. You can set rules that define how the conversation flows depending on the user’s inputs. It works like “if user has intention A and mentions entity X, then this is what Conversation should answer back. If then the user’s answer to that message holds entity Y, move to the next step and deliver this other answer”. Note that you can test and “teach” your Conversation instance in the same Dialog window, for a more exact input recognition.</li>
</ul>
<p>You can experiment with different intents, entities and dialog flows and then let’s add Conversation to our code. To do that we are going to use IBM Watson’s SDK, which I mentioned above. Again, you can find it <a href="https://github.com/watson-developer-cloud/node-sdk" target="_blank" rel="external">here</a>. Note that you will need your workspace’s credentials to access the API. You can get them the following way:</p>
<blockquote>
<p>To access the Conversation service REST APIs, your application needs to be able to authenticate with IBM® Bluemix® and connect to the right Conversation workspace. You’ll need to copy the service credentials and workspace ID and paste them into your application code.<br>You can access the service credentials and the workspace ID from your workspace by selecting the Menu menu and choosing Credentials.<br>You can also access the service credentials from your Bluemix dashboard.</p>
</blockquote>
<p>Once you have your credentials we will start by writing a small library that lets us start using Conversation:</p>
<p><code>npm install watson-developer-cloud --save</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* conversation.js */</span></div><div class="line"><span class="meta"></span></div><div class="line">'use strict';</div><div class="line"><span class="keyword">const</span> ConversationV1 = <span class="built_in">require</span>(<span class="string">'watson-developer-cloud/conversation/v1'</span>);</div><div class="line"></div><div class="line"><span class="comment">// new instance of Conversation</span></div><div class="line"><span class="keyword">const</span> conversation = <span class="keyword">new</span> ConversationV1(&#123;</div><div class="line">  <span class="attr">username</span>: process.env.CONVERSATION_USERNAME,</div><div class="line">  <span class="attr">password</span>: process.env.CONVERSATION_PASSWORD,</div><div class="line">  <span class="attr">version_date</span>: ConversationV1.VERSION_DATE_2017_02_03</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Call to Conversation API: send message</div><div class="line"> * </div><div class="line"> * @param &#123;string&#125; text </div><div class="line"> * @param &#123;object&#125; context </div><div class="line"> * @returns &#123;promise&#125;</div><div class="line"> */</div><div class="line">exports.sendMessage = <span class="function">(<span class="params">text, context</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">const</span> payload = &#123;</div><div class="line">    <span class="attr">workspace_id</span>: process.env.WORKSPACE_ID,</div><div class="line">    <span class="attr">input</span>: &#123;</div><div class="line">      <span class="attr">text</span>: text</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">context</span>: context</div><div class="line">  &#125;;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> conversation.message(payload, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      reject(err);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      resolve(data);</div><div class="line">    &#125;</div><div class="line">  &#125;));</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>And then let’s add it to our chat bot logic:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* chatbots.js */</span></div><div class="line"><span class="meta"></span></div><div class="line">'use strict';</div><div class="line"><span class="keyword">const</span> Botkit       = <span class="built_in">require</span>(<span class="string">'botkit'</span>);</div><div class="line"><span class="keyword">const</span> Conversation = <span class="built_in">require</span>(<span class="string">'./conversation'</span>); <span class="comment">// this is new</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> slack_token  = process.env.SLACK_TOKEN;</div><div class="line"><span class="keyword">const</span> slack_oauth  = process.env.SLACK_OAUTH;</div><div class="line"></div><div class="line">exports.fn = &#123;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * Starts Slack-Bot</div><div class="line">	 *</div><div class="line">	 * @returns &#123;*&#125;</div><div class="line">	 */</div><div class="line">	slackBot() &#123;</div><div class="line"></div><div class="line">		<span class="comment">// initialisation</span></div><div class="line">		<span class="keyword">const</span> slackController = Botkit.slackbot(&#123;</div><div class="line">			<span class="comment">// optional: wait for a confirmation events for each outgoing message before continuing to the next message in a conversation</span></div><div class="line">			require_delivery: <span class="literal">true</span></div><div class="line">		&#125;);</div><div class="line">		<span class="keyword">const</span> slackBot = slackController.spawn(&#123;</div><div class="line">			<span class="attr">token</span>: slack_token</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// create rtm connection</span></div><div class="line">		slackBot.startRTM(<span class="function">(<span class="params">err, bot, payload</span>) =&gt;</span> &#123;</div><div class="line">			<span class="keyword">if</span> (err) &#123;</div><div class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Could not connect to Slack'</span>);</div><div class="line">			&#125;</div><div class="line">			slackController.log(<span class="string">'Slack connection established.'</span>);</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// listener that handles incoming messages</span></div><div class="line">		slackController.hears([<span class="string">'.*'</span>], [<span class="string">'direct_message'</span>, <span class="string">'direct_mention'</span>], (bot, message) =&gt; &#123;</div><div class="line">			</div><div class="line">			<span class="comment">// THIS IS THE NEW CODE:</span></div><div class="line"></div><div class="line">			<span class="comment">// pass the slack message to IBM Watson's Conversation</span></div><div class="line">			Conversation.sendMessage(<span class="built_in">String</span>(message.text), <span class="literal">undefined</span>) <span class="comment">// at first message the context is still undefined</span></div><div class="line">				.then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</div><div class="line">					slackController.log(<span class="string">'Response from Watson received'</span>);</div><div class="line"></div><div class="line">					<span class="comment">// do something here and then reply to the user through slack</span></div><div class="line">					<span class="comment">// note: Watson's response text is stored in "response.output.text"</span></div><div class="line">					<span class="comment">// ("join('\n')" is for cases when the response is multiline)</span></div><div class="line">					bot.reply(message, response.output.text.join(<span class="string">'\n'</span>));</div><div class="line">				&#125;)</div><div class="line">				.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</div><div class="line">					<span class="built_in">console</span>.error(<span class="built_in">JSON</span>.stringify(err, <span class="literal">null</span>, <span class="number">2</span>));</div><div class="line">				&#125;);</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>So as you see you could send a message to Watson and then just forward its response back to the user, or you could take the intent from Watson’s response object and do some logic yourself:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* chatbots.js */</span></div><div class="line"></div><div class="line">[...]</div><div class="line"><span class="comment">// listener that handles incoming messages</span></div><div class="line">slackController.hears([<span class="string">'.*'</span>], [<span class="string">'direct_message'</span>, <span class="string">'direct_mention'</span>], (bot, message) =&gt; &#123;</div><div class="line">			</div><div class="line">	<span class="comment">// pass the slack message to IBM Watson's Conversation</span></div><div class="line">	Conversation.sendMessage(<span class="built_in">String</span>(message.text), <span class="literal">undefined</span>)</div><div class="line">		.then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</div><div class="line">			slackController.log(<span class="string">'Response from Watson received'</span>);</div><div class="line"></div><div class="line">			<span class="comment">// let's do different stuff depending on the intent</span></div><div class="line">			<span class="keyword">if</span> (response.intents[<span class="number">0</span>].intent === <span class="string">'xxx'</span>) &#123;</div><div class="line">				slackController.log(<span class="string">'Detected intent'</span>);</div><div class="line">				bot.reply(message, <span class="string">'I got intent xxx'</span>);</div><div class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (response.intents[<span class="number">0</span>].intent === <span class="string">'yyy'</span>) &#123;</div><div class="line">				slackController.log(<span class="string">'Detected intent'</span>);</div><div class="line">				bot.reply(message, <span class="string">'I got intent yyy'</span>);</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				slackController.log(<span class="string">'Could not detect intent'</span>);</div><div class="line">				bot.reply(message, <span class="string">'I do not know what you want'</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;)</div><div class="line">		.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</div><div class="line">			<span class="built_in">console</span>.error(<span class="built_in">JSON</span>.stringify(err, <span class="literal">null</span>, <span class="number">2</span>));</div><div class="line">		&#125;);</div><div class="line">&#125;);</div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>So as you see the possibilities here are only limited by your imagination. You can build lots of awesome stuff when using these tools together. Feel free to experiment and let me know which amazing projects you built.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>I know that this is not an extensive step-by-step guide with lots of details, but that wasn’t exactly my goal. My aim here was to show you quickly an idea on how you could put these two tools together in order to build some cool projects and have fun with it.<br>As always I more than welcome any kind of feedback! Thanks for reading this content and see you around soon!</p>


                <hr>

                

                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2017/03/12/Real-time-deployments-with-now/" data-toggle="tooltip" data-placement="top" title="Real time deployments with Zeit's Now">&larr; Previous Post</a>
                        </li>
                    
                    
                </ul>

                

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

            </div>
    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->

            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#JavaScript" title="JavaScript">JavaScript</a>
                        
                          <a class="tag" href="/tags/#ChatBots" title="ChatBots">ChatBots</a>
                        
                          <a class="tag" href="/tags/#AI" title="AI">AI</a>
                        
                          <a class="tag" href="/tags/#Slack" title="Slack">Slack</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://devchat.tv/" target="_blank">DevChat.tv</a></li>
                    
                        <li><a href="https://changelog.com/" target="_blank">The Changelog</a></li>
                    
                        <li><a href="http://nodeup.com/" target="_blank">NodeUp</a></li>
                    
                        <li><a href="http://tim.blog/podcast/" target="_blank">Tim Ferriss Show</a></li>
                    
                        <li><a href="https://dev.to/" target="_blank">Dev.to</a></li>
                    
                        <li><a href="https://www.oreilly.com/ideas" target="_blank">O&#39;Reilly Ideas</a></li>
                    
                        <li><a href="https://news.ycombinator.com/" target="_blank">Hacker News</a></li>
                    
                        <li><a href="https://scotch.io/" target="_blank">Scotch.io</a></li>
                    
                </ul>
                
            </div>

        </div>
    </div>
</article>




<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "olegkorol";
    var disqus_identifier = "https://olegkorol.github.io/2017/04/23/Creating-a-smart-ChatBot-for-Slack/";
    var disqus_url = "https://olegkorol.github.io/2017/04/23/Creating-a-smart-ChatBot-for-Slack/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/oleg_korol">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/olegkorol.de">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/olegkorol">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/oleg-korol-a8057628">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyleft - Just another random Blog 2017
                    <br>
                    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
                    <a href="https://twitter.com/intent/tweet?screen_name=oleg_korol" class="twitter-mention-button" data-show-count="false">Tweet to @oleg_korol</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://olegkorol.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-66639263-1';
    var _gaDomain = 'olegkorol.de';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Side Catalog -->




</body>

</html>
